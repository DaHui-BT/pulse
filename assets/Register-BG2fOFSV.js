var L=Object.defineProperty;var O=(l,t,a)=>t in l?L(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a;var _=(l,t,a)=>O(l,typeof t!="symbol"?t+"":t,a);import{as as d,d as v,r as N,x,o as A,c as I,b as r,w as i,e as f,f as g,bc as B,cn as F,au as T,co as U,B as k,_ as z,h as M}from"./index-N6LQE3m8.js";import{D as R}from"./database-twbR-smW.js";import{c as S,f as q,_ as D}from"./loading-DyZsQa9r.js";import{G as V}from"./Glassmorphism-Lr6Jtw3X.js";import{L as Z}from"./Link-DK10h0vO.js";import{F as G}from"./index-CxV8_SQk.js";import"./index-Lq2ZO3Od.js";import"./transButton-B4cmm4Oi.js";import"./_flatRest-wfqK8UWO.js";class ${constructor(){_(this,"database");_(this,"COLLECTION_NAME","user");this.database=R.getInstance()}getUser(){return this.database.getUser()}async login(t,a){return new Promise((e,s)=>{this.database.connect(t,a).then(()=>{e()}).catch(o=>{s(o)})})}async register(t,a){return new Promise((e,s)=>{this.database.register(t,a).then(()=>{e()}).catch(o=>{s(o)})})}async confirmUser(t,a){return new Promise((e,s)=>{this.database.confirmUser(t,a).then(()=>{e()}).catch(o=>{s(o)})})}async resendConfirmationEmail(t){return new Promise((a,e)=>{this.database.resendConfirmationEmail(t).then(()=>{a()}).catch(s=>{e(s)})})}async sendResetPasswordEmail(t){return new Promise((a,e)=>{this.database.sendResetPasswordEmail(t).then(()=>{a()}).catch(s=>{e(s)})})}async findList(t={},a={page:0,page_size:10}){return new Promise((e,s)=>{this.database.findList(this.COLLECTION_NAME,t,a).then(o=>{e(o)}).catch(o=>{console.log(o),s(o)})})}async findOne(t){return new Promise((a,e)=>{this.database.findOne(this.COLLECTION_NAME,t).then(s=>{a(s)}).catch(s=>{d.error(s),console.log(s),e(s)})})}async addOne(t){return new Promise((a,e)=>{this.database.addOne(this.COLLECTION_NAME,t).then(s=>{a(s)}).catch(s=>{d.error(s),console.log(s),e(s)})})}async updateById(t,a){return new Promise((e,s)=>{this.database.updateOne(this.COLLECTION_NAME,{_id:{$eq:t}},a).then(o=>{e(o)}).catch(o=>{d.error(o),console.log(o),s(o)})})}async updateAvatar(t,a){const e=await S(a);if(e==null)throw Error("compress image error");let s;return await q(e).then(o=>{s=o}),console.log(s),this.updateById(t,{avatar:{filename:e.name,type:e.type,size:e.size,data:s}})}}const j={class:"register"},J=v({__name:"Register",setup(l){const t=B(),a=new $,e=N({email:"",password:""}),s=m=>{a.register(m.email,m.password).then(()=>{setTimeout(()=>{t.push({path:"/login"})},F)})},o=m=>{console.log("Failed:",m);for(let n of m.errorFields)for(let c of n.errors)d.error(c)},w=x(()=>!(e.email&&e.password));function y(){e.email.length==0?d.error("Please input your email first"):a.resendConfirmationEmail(e.email)}return(m,n)=>{const c=T,u=D,b=U,E=k,h=Z,C=z,P=G;return A(),I("div",j,[r(V,{opacity:.6,"border-radius":5},{default:i(()=>[r(P,{model:e,name:"normal_register",class:"register-form",onFinish:s,onFinishFailed:o},{default:i(()=>[n[7]||(n[7]=f("h2",{class:"register-form-title"},"Sign up",-1)),r(u,{name:"email",rules:[{required:!0,message:"Please input your email!"},{pattern:/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/,message:"Email address format not correct"}]},{default:i(()=>[r(c,{value:e.email,"onUpdate:value":n[0]||(n[0]=p=>e.email=p),placeholder:"Email"},{prefix:i(()=>n[2]||(n[2]=[f("i",{class:"iconfont"},"",-1)])),_:1},8,["value"])]),_:1}),r(u,{name:"password",rules:[{required:!0,message:"Please input your password!"},{min:6,max:32,message:"Password should in range of (6, 32)"}]},{default:i(()=>[r(b,{value:e.password,"onUpdate:value":n[1]||(n[1]=p=>e.password=p),placeholder:"Password"},{prefix:i(()=>n[3]||(n[3]=[f("i",{class:"iconfont"},"",-1)])),_:1},8,["value"])]),_:1}),r(u,null,{default:i(()=>[r(E,{disabled:w.value,type:"primary","html-type":"submit",class:"register-form-button"},{default:i(()=>n[4]||(n[4]=[g(" Sign up ")])),_:1},8,["disabled"]),r(C,{justify:"space-between"},{default:i(()=>[r(h,{href:"#/login"},{default:i(()=>n[5]||(n[5]=[g("Login now!")])),_:1}),r(h,{type:"link",onClick:y},{default:i(()=>n[6]||(n[6]=[g("Resend confirm email")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),oe=M(J,[["__scopeId","data-v-ec52b40a"]]);export{oe as default};
