var L=Object.defineProperty;var O=(l,a,t)=>a in l?L(l,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[a]=t;var _=(l,a,t)=>O(l,typeof a!="symbol"?a+"":a,t);import{ai as d,g as v,ah as N,h as A,ak as I,al as x,j as r,am as i,aQ as f,an as g,bc as F,cn as T,aq as U,co as k,a7 as B,ar as z,aS as M}from"./index-YXsaEbfY.js";import{D as R}from"./database-CYmS3YH7.js";import{c as S,f as q,_ as D}from"./loading-BE02Z-wR.js";import{G as V}from"./Glassmorphism-BxvH46Nz.js";import{L as Z}from"./Link-CBQOg2X_.js";import{F as j}from"./index-CIN2uac1.js";import"./index-BFSLzwoB.js";import"./transButton-15gD8E64.js";import"./_flatRest-64rrj3zR.js";class G{constructor(){_(this,"database");_(this,"COLLECTION_NAME","user");this.database=R.getInstance()}getUser(){return this.database.getUser()}async login(a,t){return new Promise((e,s)=>{this.database.connect(a,t).then(()=>{e()}).catch(n=>{s(n)})})}async register(a,t){return new Promise((e,s)=>{this.database.register(a,t).then(()=>{e()}).catch(n=>{s(n)})})}async confirmUser(a,t){return new Promise((e,s)=>{this.database.confirmUser(a,t).then(()=>{e()}).catch(n=>{s(n)})})}async resendConfirmationEmail(a){return new Promise((t,e)=>{this.database.resendConfirmationEmail(a).then(()=>{t()}).catch(s=>{e(s)})})}async sendResetPasswordEmail(a){return new Promise((t,e)=>{this.database.sendResetPasswordEmail(a).then(()=>{t()}).catch(s=>{e(s)})})}async findList(a={},t={page:0,page_size:10}){return new Promise((e,s)=>{this.database.findList(this.COLLECTION_NAME,a,t).then(n=>{e(n)}).catch(n=>{console.log(n),s(n)})})}async findOne(a){return new Promise((t,e)=>{this.database.findOne(this.COLLECTION_NAME,a).then(s=>{t(s)}).catch(s=>{d.error(s),console.log(s),e(s)})})}async addOne(a){return new Promise((t,e)=>{this.database.addOne(this.COLLECTION_NAME,a).then(s=>{t(s)}).catch(s=>{d.error(s),console.log(s),e(s)})})}async updateById(a,t){return new Promise((e,s)=>{this.database.updateOne(this.COLLECTION_NAME,{_id:{$eq:a}},t).then(n=>{e(n)}).catch(n=>{d.error(n),console.log(n),s(n)})})}async updateAvatar(a,t){const e=await S(t);if(e==null)throw Error("compress image error");let s;return await q(e).then(n=>{s=n}),console.log(s),this.updateById(a,{avatar:{filename:e.name,type:e.type,size:e.size,data:s}})}}const $={class:"register"},J=v({__name:"Register",setup(l){const a=F(),t=new G,e=N({email:"",password:""}),s=m=>{t.register(m.email,m.password).then(()=>{setTimeout(()=>{a.push({path:"/login"})},T)})},n=m=>{console.log("Failed:",m);for(let o of m.errorFields)for(let c of o.errors)d.error(c)},w=A(()=>!(e.email&&e.password));function y(){e.email.length==0?d.error("Please input your email first"):t.resendConfirmationEmail(e.email)}return(m,o)=>{const c=U,p=D,b=k,E=B,h=Z,C=z,P=j;return I(),x("div",$,[r(V,{opacity:.6,"border-radius":5},{default:i(()=>[r(P,{model:e,name:"normal_register",class:"register-form",onFinish:s,onFinishFailed:n},{default:i(()=>[o[7]||(o[7]=f("h2",{class:"register-form-title"},"Sign up",-1)),r(p,{name:"email",rules:[{required:!0,message:"Please input your email!"},{pattern:/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/,message:"Email address format not correct"}]},{default:i(()=>[r(c,{value:e.email,"onUpdate:value":o[0]||(o[0]=u=>e.email=u),placeholder:"Email"},{prefix:i(()=>o[2]||(o[2]=[f("i",{class:"iconfont"},"",-1)])),_:1},8,["value"])]),_:1}),r(p,{name:"password",rules:[{required:!0,message:"Please input your password!"},{min:6,max:32,message:"Password should in range of (6, 32)"}]},{default:i(()=>[r(b,{value:e.password,"onUpdate:value":o[1]||(o[1]=u=>e.password=u),placeholder:"Password"},{prefix:i(()=>o[3]||(o[3]=[f("i",{class:"iconfont"},"",-1)])),_:1},8,["value"])]),_:1}),r(p,null,{default:i(()=>[r(E,{disabled:w.value,type:"primary","html-type":"submit",class:"register-form-button"},{default:i(()=>o[4]||(o[4]=[g(" Sign up ")])),_:1},8,["disabled"]),r(C,{justify:"space-between"},{default:i(()=>[r(h,{href:"#/login"},{default:i(()=>o[5]||(o[5]=[g("Login now!")])),_:1}),r(h,{type:"link",onClick:y},{default:i(()=>o[6]||(o[6]=[g("Resend confirm email")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),ne=M(J,[["__scopeId","data-v-ec52b40a"]]);export{ne as default};
