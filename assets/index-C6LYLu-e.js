var C=Object.defineProperty;var U=(i,r,e)=>r in i?C(i,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[r]=e;var d=(i,r,e)=>U(i,typeof r!="symbol"?r+"":r,e);import{G as I}from"./Glassmorphism-SPlXkDc8.js";import{aj as S,d as T,a5 as B,c as E,aQ as L,a6 as N,a7 as V,b as o,ak as a,a8 as f,a9 as g,aS as G,aR as j,aP as _,aT as A,am as D,ah as J}from"./index-C65JRPnL.js";import{R as M}from"./request-CV5hgAz3.js";import{L as h}from"./loading-DdwsQ6h4.js";import{I as O,a as Q,F as Y}from"./index-CFjYZmsW.js";import{C as $}from"./index-CSIMR4oO.js";import{_ as z}from"./FormItem-CD720ya9.js";import"./index-Dt6m71WR.js";import"./isSymbol-BWNvmBAv.js";import"./TextArea-dYSLGRQh.js";import"./isPlainObject-C4LvJLV6.js";import"./debounce-C5-2cbFb.js";import"./toNumber-COwC2iKS.js";import"./Checkbox-rpZfcAw0.js";import"./index-R9UxSUKx.js";const u=class u{constructor(){d(this,"request");d(this,"store");this.request=new M,this.store=S()}static getInstance(){return u.instance||(u.instance=new u),u.instance}async login(r,e){try{const n=await this.request.post("/login",{data:{username:r,password:e}});return n.code==200?(this.store.login(n.data.token,n.data.refreshToken,n.data.user),{success:!0}):{success:!1,error:n.message}}catch(n){return{success:!1,error:n.message}}}async register(r,e,n){try{const t=await this.request.post("/register",{data:{email:e,username:r,password:n}});return t.code==200?{success:!0}:{success:!1,error:t.message}}catch(t){return{success:!1,error:t.message}}}async refreshToken(r){try{const e=await this.request.post("/refresh",{data:{token:r}});return e.code==200?{success:!0}:{success:!1,error:e.message}}catch(e){return{success:!1,error:e.message}}}async confirmAuth(r){try{const e=await this.request.post("/user/confirm",{data:{token:r}});return e.code==200?{success:!0}:{success:!1,error:e.message}}catch(e){return{success:!1,error:e.message}}}async resendConfirmationEmail(r){try{const e=await this.request.post("/user/resend-email",{data:{email:r}});return e.code==200?{success:!0}:{success:!1,error:e.message}}catch(e){return{success:!1,error:e.message}}}async sendResetPasswordEmail(r){try{return await this.request.get(`/reset-password/${r}`)?{success:!0}:{success:!1}}catch(e){return{success:!1,error:e.message}}}};d(u,"instance");let w=u;const H={class:"login"},K=T({__name:"index",setup(i){const r=G(),e=j(),n=w.getInstance(),t=B({username:"",password:"",remember:!0}),y=c=>{h.show(),n.login(c.username,c.password).then(s=>{if(s.success){_.success("login successfully");let m="/";e.query.from&&(m=e.query.from.toString()),setTimeout(()=>{r.push({path:m})},A)}else _.error(s.error);h.hide()})},b=c=>{for(let s of c.errorFields)for(let m of s.errors)_.error(m)},k=E(()=>!(t.username&&t.password));return(c,s)=>{const m=O,l=z,q=Q,x=$,v=D,R=L("router-link"),F=Y,P=I;return N(),V("div",H,[o(P,{opacity:.6,"border-radius":5},{default:a(()=>[o(F,{model:t,name:"normal_login",class:"login-form",onFinish:y,onFinishFailed:b},{default:a(()=>[s[10]||(s[10]=f("h2",{class:"login-form-title"},"Sign in",-1)),o(l,{label:"Username",name:"username",rules:[{required:!0,message:"Please input your username!"}]},{default:a(()=>[o(m,{value:t.username,"onUpdate:value":s[0]||(s[0]=p=>t.username=p),placeholder:"Username"},{prefix:a(()=>s[3]||(s[3]=[f("i",{class:"iconfont"},"",-1)])),_:1},8,["value"])]),_:1}),o(l,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"},{min:6,max:32,message:"Password should in range of (6, 32)"}]},{default:a(()=>[o(q,{value:t.password,"onUpdate:value":s[1]||(s[1]=p=>t.password=p),placeholder:"Password"},{prefix:a(()=>s[4]||(s[4]=[f("i",{class:"iconfont"},"",-1)])),_:1},8,["value"])]),_:1}),o(l,null,{default:a(()=>[o(l,{name:"remember","no-style":""},{default:a(()=>[o(x,{checked:t.remember,"onUpdate:checked":s[2]||(s[2]=p=>t.remember=p)},{default:a(()=>s[5]||(s[5]=[g("Remember me")])),_:1},8,["checked"])]),_:1}),s[6]||(s[6]=f("a",{class:"login-form-forgot",href:""},"Forgot password",-1))]),_:1}),o(l,null,{default:a(()=>[o(v,{disabled:k.value,type:"primary","html-type":"submit",class:"login-form-button"},{default:a(()=>s[7]||(s[7]=[g(" Log in ")])),_:1},8,["disabled"]),s[9]||(s[9]=g(" Or ")),o(R,{to:"/register"},{default:a(()=>s[8]||(s[8]=[g("Sign up now!")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),de=J(K,[["__scopeId","data-v-b4571b4f"]]);export{de as default};
