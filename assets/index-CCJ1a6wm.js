import{d as L,aw as O,ax as Q,I as Z,h as m,n as f,o as z,M as l,p as y,q as T,c as a,K as t,aU as G,O as d,x as s,F as J,y as W,P as X,C as p,t as ee,Z as te,Q as oe,E as ae}from"./index-CsOaHWZQ.js";import{d as v}from"./dayjs.min-Dzxo81jm.js";import{F as re}from"./file.service-1Vyq2a0K.js";import{B as ne}from"./index-BfPHKHhH.js";import{T as se}from"./index-BCVWfUXc.js";import{T as ie}from"./Text-y7tKTZQ3.js";import{P as le}from"./Paragraph-CED5ZpRN.js";import{S as pe}from"./index-DC9JQhQ7.js";import{_ as ue,a as de,b as _e}from"./index-DciyHouH.js";import"./request-zUbwgvDi.js";import"./RightOutlined-BSKPiX3E.js";import"./Base-uFvm4X4A.js";import"./Dropdown-DuIXQ8-m.js";import"./ActionButton-CHxIZdPV.js";import"./index-DWKhQI0h.js";const ce={class:"repository"},me=["src"],fe=L({__name:"index",setup(ye){var w;const C=O(),F=Q(),g=Z(),h=re.getInstance(),o=m(),x=m(!0),A=m(),I=f(g.tags),b=f([]),R=f([{path:"/",breadcrumbName:"Home"},{path:"/repository",breadcrumbName:"Repository"},{path:"/repository-info",breadcrumbName:((w=o.value)==null?void 0:w.title)||""}]);z(()=>{const i=C.query._id;if(!i)throw new Error("No such repository");h.findFileById(i).then(e=>{console.log(e),e.success&&e.data?(o.value=e.data,b.push(...I.filter(n=>{var u;return(u=o.value)==null?void 0:u.tags.includes(n._id)})||[])):l.error(e.error)}).catch(e=>l.error(e.message)).finally(()=>x.value=!1)});function E(){var i;F.push({path:"/publish",query:{_id:((i=o.value)==null?void 0:i._id)+"",type:"File"}})}function P(){var i,e;if(!((i=o.value)!=null&&i._id))throw new Error("No such Repository");h.deletePerpetualById((e=o.value)==null?void 0:e._id).then(n=>{n.success?l.success(n.message):l.error(n.error)}).catch(n=>l.error(n.message))}function q(){l.info("删除操作已取消")}return(i,e)=>{const n=ne,u=ue,U=se,V=de,_=ie,c=te,j=oe,$=le,H=_e,K=pe;return y(),T("div",ce,[a(K,{spinning:x.value},{default:t(()=>{var Y,B,k,M,N,D;return[a(V,{title:(Y=o.value)==null?void 0:Y.title,class:"repository-detail-header",avatar:{src:(B=A.value)==null?void 0:B.avatar},breadcrumb:{routes:R},onBack:e[0]||(e[0]=()=>i.$router.go(-1))},G({tags:t(()=>[(y(!0),T(J,null,W(b,r=>(y(),X(U,{color:"blue",key:r._id},{default:t(()=>[s(p(r.name),1)]),_:2},1024))),128))]),_:2},[((k=o.value)==null?void 0:k.createdBy)==d(g).user._id?{name:"extra",fn:t(()=>[a(n,{type:"primary",onClick:E},{default:t(()=>e[1]||(e[1]=[s("修改")])),_:1}),a(u,{title:"确认删除?",onConfirm:P,onCancel:q,okText:"确认",cancelText:"取消"},{default:t(()=>[a(n,{type:"primary",danger:""},{default:t(()=>e[2]||(e[2]=[s("删除")])),_:1})]),_:1})]),key:"0"}:void 0]),1032,["title","avatar","breadcrumb"]),a(j,{gap:"20",wrap:"wrap",class:"repository-function",justify:"flex-end"},{default:t(()=>[a(c,null,{title:t(()=>e[3]||(e[3]=[s("创建时间")])),default:t(()=>[a(_,{type:"secondary"},{default:t(()=>{var r;return[s("创建于: "+p(d(v)((r=o.value)==null?void 0:r.createdAt).format("YYYY-MM-DD")),1)]}),_:1})]),_:1}),a(c,null,{title:t(()=>e[4]||(e[4]=[s("更新日期")])),default:t(()=>[a(_,{type:"secondary"},{default:t(()=>{var r;return[s("更新于: "+p(d(v)((r=o.value)==null?void 0:r.updatedAt).format("YYYY-MM-DD")),1)]}),_:1})]),_:1}),a(c,null,{title:t(()=>e[5]||(e[5]=[s("过期时间")])),default:t(()=>[a(_,{type:"secondary"},{default:t(()=>{var r,S;return[s("过期于: "+p((r=o.value)!=null&&r.expiredAt?d(v)((S=o.value)==null?void 0:S.expiredAt).format("YYYY-MM-DD"):"永久"),1)]}),_:1})]),_:1})]),_:1}),a($,null,{default:t(()=>{var r;return[s(p((r=o.value)==null?void 0:r.description),1)]}),_:1}),a(n,{class:"download-button",type:"primary",href:(M=o.value)==null?void 0:M.dataUrl,download:(N=o.value)==null?void 0:N.filename},{default:t(()=>e[6]||(e[6]=[s("下载")])),_:1},8,["href","download"]),a(H,{class:"divider"}),ee("embed",{src:(D=o.value)==null?void 0:D.dataUrl,style:{height:"60vh",width:"100%"}},null,8,me)]}),_:1},8,["spinning"])])}}}),Fe=ae(fe,[["__scopeId","data-v-07d28f67"]]);export{Fe as default};
