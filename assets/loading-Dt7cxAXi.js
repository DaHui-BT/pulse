import{cA as Me,ax as Ae,cB as Te,i as Se,cC as xe,cD as je,cE as se,cF as qe,aR as Ve,z as Fe,aW as N,r as _e,a5 as Re,U as X,x as w,W as Ne,ci as oe,cG as Pe,d as We,C as De,I as $e,v as k,cH as ze,cI as Be,cJ as Ge,ao as Ke,a as pe,y as ue,a0 as ce,P as Ue,m as Q,j as U,s as de,n as fe,l as He,h as B,Q as Je,cK as re,b_ as ge}from"./index-Ba7BTyn2.js";import{t as me,c as Qe,g as Xe,a as Ye,d as ee,v as Ze,e as Ce,_ as et,f as tt,h as nt,s as rt,i as he,j as Y,k as ve,l as it}from"./FormItem-CSQuUzAA.js";import{e as at,f as ie,b as lt,c as Ee,t as st,S as ot}from"./index-tyPRltW9.js";import{s as ut,o as ct,f as dt}from"./_flatRest-hVIAHiNU.js";function ft(e,t){return ut(ct(e,t,at),e+"")}function gt(e,t,n){var s=-1,r=e.length;t<0&&(t=-t>r?0:r+t),n=n>r?r:n,n<0&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;for(var u=Array(r);++s<r;)u[s]=e[s+t];return u}var te=function(){return Me.Date.now()},mt="Expected a function",ht=Math.max,vt=Math.min;function yt(e,t,n){var s,r,u,f,h,v,P=0,p=!1,C=!1,I=!0;if(typeof e!="function")throw new TypeError(mt);t=me(t)||0,Ae(n)&&(p=!!n.leading,C="maxWait"in n,u=C?ht(me(n.maxWait)||0,t):u,I="trailing"in n?!!n.trailing:I);function L(o){var c=s,d=r;return s=r=void 0,P=o,f=e.apply(d,c),f}function O(o){return P=o,h=setTimeout(M,t),p?L(o):f}function S(o){var c=o-v,d=o-P,A=t-c;return C?vt(A,u-d):A}function q(o){var c=o-v,d=o-P;return v===void 0||c>=t||c<0||C&&d>=u}function M(){var o=te();if(q(o))return V(o);h=setTimeout(M,S(o))}function V(o){return h=void 0,I&&s?L(o):(s=r=void 0,f)}function l(){h!==void 0&&clearTimeout(h),P=0,s=v=r=h=void 0}function i(){return h===void 0?f:V(te())}function m(){var o=te(),c=q(o);if(s=arguments,r=this,v=o,c){if(h===void 0)return O(v);if(C)return clearTimeout(h),h=setTimeout(M,t),L(v)}return h===void 0&&(h=setTimeout(M,t)),f}return m.cancel=l,m.flush=i,m}function bt(e){return Te(e)&&Se(e)}function Ft(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var Pt=Math.min;function pt(e,t,n){for(var s=qe,r=e[0].length,u=e.length,f=u,h=Array(u),v=1/0,P=[];f--;){var p=e[f];f&&t&&(p=ie(p,xe(t))),v=Pt(p.length,v),h[f]=r>=120&&p.length>=120?new je(f&&p):void 0}p=e[0];var C=-1,I=h[0];e:for(;++C<r&&P.length<v;){var L=p[C],O=L;if(L=L!==0?L:0,!(I?se(I,O):s(P,O))){for(f=u;--f;){var S=h[f];if(!(S?se(S,O):s(e[f],O)))continue e}I&&I.push(O),P.push(L)}}return P}function Ct(e){return bt(e)?e:[]}var Et=ft(function(e){var t=ie(e,Ct);return t.length&&t[0]===e[0]?pt(t):[]});function kt(e,t){return t.length<2?e:lt(e,gt(t,0,-1))}function It(e,t){return t=Ee(t,e),e=kt(e,t),e==null||delete e[st(Ft(t))]}function Lt(e){return Ve(e)?void 0:e}var Ot=1,wt=2,Mt=4,At=dt(function(e,t){var n={};if(e==null)return n;var s=!1;t=ie(t,function(u){return u=Ee(u,e),s||(s=u.length>1),u}),Qe(e,Xe(e),n),s&&(n=Ye(n,Ot|wt|Mt,Lt));for(var r=t.length;r--;)It(n,t[r]);return n});function ke(e){let t=!1,n=e.length;const s=[];return e.length?new Promise((r,u)=>{e.forEach((f,h)=>{f.catch(v=>(t=!0,v)).then(v=>{n-=1,s[h]=v,!(n>0)&&(t&&u(s),r(s))})})}):Promise.resolve([])}function ye(e){let t=!1;return e&&e.length&&e.every(n=>n.required?(t=!0,!1):!0),t}function be(e){return e==null?[]:Array.isArray(e)?e:[e]}function ne(e,t,n){let s=e;t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,"");const r=t.split(".");let u=0;for(let f=r.length;u<f-1&&!(!s&&!n);++u){const h=r[u];if(h in s)s=s[h];else{if(n)throw new Error("please transfer a valid name path to validate!");break}}return{o:s,k:r[u],v:s?s[r[u]]:null,isValid:s&&r[u]in s}}function Tt(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Fe({}),n=arguments.length>2?arguments[2]:void 0;const s=ee(N(e)),r=_e({}),u=Re([]),f=l=>{w(N(e),w(w({},ee(s)),l)),Ne(()=>{Object.keys(r).forEach(i=>{r[i]={autoLink:!1,required:ye(N(t)[i])}})})},h=function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],i=arguments.length>1?arguments[1]:void 0;return i.length?l.filter(m=>{const o=be(m.trigger||"change");return Et(o,i).length}):l};let v=null;const P=function(l){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0;const o=[],c={};for(let E=0;E<l.length;E++){const F=l[E],x=ne(N(e),F,m);if(!x.isValid)continue;c[F]=x.v;const D=h(N(t)[F],be(i&&i.trigger));D.length&&o.push(p(F,x.v,D,i||{}).then(()=>({name:F,errors:[],warnings:[]})).catch($=>{const z=[],G=[];return $.forEach(a=>{let{rule:{warningOnly:g},errors:y}=a;g?G.push(...y):z.push(...y)}),z.length?Promise.reject({name:F,errors:z,warnings:G}):{name:F,errors:z,warnings:G}}))}const d=ke(o);v=d;const A=d.then(()=>v===d?Promise.resolve(c):Promise.reject([])).catch(E=>{const F=E.filter(x=>x&&x.errors.length);return F.length?Promise.reject({values:c,errorFields:F,outOfDate:v!==d}):Promise.resolve(c)});return A.catch(E=>E),A},p=function(l,i,m){let o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const c=Ze([l],i,m,w({validateMessages:Ce},o),!!o.validateFirst);return r[l]?(r[l].validateStatus="validating",c.catch(d=>d).then(function(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];var A;if(r[l].validateStatus==="validating"){const E=d.filter(F=>F&&F.errors.length);r[l].validateStatus=E.length?"error":"success",r[l].help=E.length?E.map(F=>F.errors):null,(A=n==null?void 0:n.onValidate)===null||A===void 0||A.call(n,l,!E.length,E.length?oe(r[l].help[0]):null)}}),c):c.catch(d=>d)},C=(l,i)=>{let m=[],o=!0;l?Array.isArray(l)?m=l:m=[l]:(o=!1,m=u.value);const c=P(m,i||{},o);return c.catch(d=>d),c},I=l=>{let i=[];l?Array.isArray(l)?i=l:i=[l]:i=u.value,i.forEach(m=>{r[m]&&w(r[m],{validateStatus:"",help:null})})},L=l=>{const i={autoLink:!1},m=[],o=Array.isArray(l)?l:[l];for(let c=0;c<o.length;c++){const d=o[c];(d==null?void 0:d.validateStatus)==="error"&&(i.validateStatus="error",d.help&&m.push(d.help)),i.required=i.required||(d==null?void 0:d.required)}return i.help=m,i};let O=s,S=!0;const q=l=>{const i=[];u.value.forEach(m=>{const o=ne(l,m,!1),c=ne(O,m,!1);(S&&(n==null?void 0:n.immediate)&&o.isValid||!Pe(o.v,c.v))&&i.push(m)}),C(i,{trigger:"change"}),S=!1,O=ee(oe(l))},M=n==null?void 0:n.debounce;let V=!0;return X(t,()=>{u.value=t?Object.keys(N(t)):[],!V&&n&&n.validateOnRuleChange&&C(),V=!1},{deep:!0,immediate:!0}),X(u,()=>{const l={};u.value.forEach(i=>{l[i]=w({},r[i],{autoLink:!1,required:ye(N(t)[i])}),delete r[i]});for(const i in r)Object.prototype.hasOwnProperty.call(r,i)&&delete r[i];w(r,l)},{immediate:!0}),X(e,M&&M.wait?yt(q,M.wait,At(M,["wait"])):q,{immediate:n&&!!n.immediate,deep:!0}),{modelRef:e,rulesRef:t,initialModel:s,validateInfos:r,resetFields:f,validate:C,validateField:p,mergeValidateInfo:L,clearValidate:I}}const St=()=>({layout:ce.oneOf(Ue("horizontal","inline","vertical")),labelCol:Q(),wrapperCol:Q(),colon:U(),labelAlign:de(),labelWrap:U(),prefixCls:String,requiredMark:fe([String,Boolean]),hideRequiredMark:U(),model:ce.object,rules:Q(),validateMessages:Q(),validateOnRuleChange:U(),scrollToFirstError:He(),onSubmit:B(),name:String,validateTrigger:fe([String,Array]),size:de(),disabled:U(),onValuesChange:B(),onFieldsChange:B(),onFinish:B(),onFinishFailed:B(),onValidate:B()});function xt(e,t){return Pe(Y(e),Y(t))}const W=We({compatConfig:{MODE:3},name:"AForm",inheritAttrs:!1,props:De(St(),{layout:"horizontal",hideRequiredMark:!1,colon:!0}),Item:et,useForm:Tt,setup(e,t){let{emit:n,slots:s,expose:r,attrs:u}=t;const{prefixCls:f,direction:h,form:v,size:P,disabled:p}=$e("form",e),C=k(()=>e.requiredMark===""||e.requiredMark),I=k(()=>{var a;return C.value!==void 0?C.value:v&&((a=v.value)===null||a===void 0?void 0:a.requiredMark)!==void 0?v.value.requiredMark:!e.hideRequiredMark});ze(P),Be(p);const L=k(()=>{var a,g;return(a=e.colon)!==null&&a!==void 0?a:(g=v.value)===null||g===void 0?void 0:g.colon}),{validateMessages:O}=Ge(),S=k(()=>w(w(w({},Ce),O.value),e.validateMessages)),[q,M]=tt(f),V=k(()=>Ke(f.value,{[`${f.value}-${e.layout}`]:!0,[`${f.value}-hide-required-mark`]:I.value===!1,[`${f.value}-rtl`]:h.value==="rtl",[`${f.value}-${P.value}`]:P.value},M.value)),l=Fe(),i={},m=(a,g)=>{i[a]=g},o=a=>{delete i[a]},c=a=>{const g=!!a,y=g?Y(a).map(ve):[];return g?Object.values(i).filter(T=>y.findIndex(_=>xt(_,T.fieldName.value))>-1):Object.values(i)},d=a=>{e.model&&c(a).forEach(g=>{g.resetField()})},A=a=>{c(a).forEach(g=>{g.clearValidate()})},E=a=>{const{scrollToFirstError:g}=e;if(n("finishFailed",a),g&&a.errorFields.length){let y={};typeof g=="object"&&(y=g),x(a.errorFields[0].name,y)}},F=function(){return z(...arguments)},x=function(a){let g=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const y=c(a?[a]:void 0);if(y.length){const T=y[0].fieldId.value,_=T?document.getElementById(T):null;_&&rt(_,w({scrollMode:"if-needed",block:"nearest"},g))}},D=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(a===!0){const g=[];return Object.values(i).forEach(y=>{let{namePath:T}=y;g.push(T.value)}),he(e.model,g)}else return he(e.model,a)},$=(a,g)=>{if(!e.model)return Promise.reject("Form `model` is required for validateFields to work.");const y=!!a,T=y?Y(a).map(ve):[],_=[];Object.values(i).forEach(j=>{var K;if(y||T.push(j.namePath.value),!(!((K=j.rules)===null||K===void 0)&&K.value.length))return;const R=j.namePath.value;if(!y||it(T,R)){const Ie=j.validateRules(w({validateMessages:S.value},g));_.push(Ie.then(()=>({name:R,errors:[],warnings:[]})).catch(Le=>{const J=[],Z=[];return Le.forEach(Oe=>{let{rule:{warningOnly:we},errors:le}=Oe;we?Z.push(...le):J.push(...le)}),J.length?Promise.reject({name:R,errors:J,warnings:Z}):{name:R,errors:J,warnings:Z}}))}});const H=ke(_);l.value=H;const ae=H.then(()=>l.value===H?Promise.resolve(D(T)):Promise.reject([])).catch(j=>{const K=j.filter(R=>R&&R.errors.length);return Promise.reject({values:D(T),errorFields:K,outOfDate:l.value!==H})});return ae.catch(j=>j),ae},z=function(){return $(...arguments)},G=a=>{a.preventDefault(),a.stopPropagation(),n("submit",a),e.model&&$().then(y=>{n("finish",y)}).catch(y=>{E(y)})};return r({resetFields:d,clearValidate:A,validateFields:$,getFieldsValue:D,validate:F,scrollToField:x}),nt({model:k(()=>e.model),name:k(()=>e.name),labelAlign:k(()=>e.labelAlign),labelCol:k(()=>e.labelCol),labelWrap:k(()=>e.labelWrap),wrapperCol:k(()=>e.wrapperCol),vertical:k(()=>e.layout==="vertical"),colon:L,requiredMark:I,validateTrigger:k(()=>e.validateTrigger),rules:k(()=>e.rules),addField:m,removeField:o,onValidate:(a,g,y)=>{n("validate",a,g,y)},validateMessages:S}),X(()=>e.rules,()=>{e.validateOnRuleChange&&$()}),()=>{var a;return q(pe("form",ue(ue({},u),{},{onSubmit:G,class:[V.value,u.class]}),[(a=s.default)===null||a===void 0?void 0:a.call(s)]))}}});W.useInjectFormItemContext=Je;W.ItemRest=re;W.install=function(e){return e.component(W.name,W),e.component(W.Item.name,W.Item),e.component(re.name,re),e};let b=null;const Rt={show(){if(!b){b=document.createElement("div"),b.style.position="fixed",b.style.top="0",b.style.left="0",b.style.width="100%",b.style.height="100%",b.style.display="flex",b.style.justifyContent="center",b.style.alignItems="center",b.style.backgroundColor="rgba(255, 255, 255, 0.8)",b.style.zIndex="9999",document.body.appendChild(b);const e=pe(ot,{size:"large",spinning:!0});ge(e,b)}},hide(){b&&(ge(null,b),document.body.removeChild(b),b=null)}};export{W as F,Rt as L};
